#### 一、创建集群
进入系统 

![图片1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片1.png)

创建集群
   登录进入系统页面后在集群管理页面创建集群，NexusFabric支持多集群管理和授予用户集群管理员权限。
   
![图片2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片2.png)
 
点击【创建集群】，输入集群名称，集群编码（集群唯一标识），集群框架。

![图片3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片3.png)

配置集群

创建成功后点击【配置集群】：

根据提示，输入主机列表（注意：主机名需与在准备环境中hostnamectl set-hostname 设置的主机名一致），ssh用户名默认为root和ssh端口默认为22。

![图片4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片4.png)

配置完成后，点击【下一步】，系统开始链接主机并进行主机环境校验。

![图片5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片5.png)

主机环境校验成功后点击【下一步】，主机agent分发步骤将自动分发datasophon-worker组件，并启动WorkerApplicationServer。主机管理Agent分发完成后，点击【下一步】，开始部署服务。

![图片6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片6.png)

初始化配置集群先选择部署Prometheus、AlertManager、Grafana。NexusFabric依赖此三个组件实现系统监控告警管理。

![图片7_2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片7_2.png)

点击【下一步】，分配Prometheus、AlertManager、Grafana服务的master服务角色部署节点，此三个组件需部署在同一台机器上，修改各服务配置。系统已给出默认配置，大部分情况下无需修改。

![图片7.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片8.png)

●ALERTMANAGER

![图片8.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片8.png)

配置页面

![图片9.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片9.png)

状态页

![图片10.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片10.png)

●Prometheus 总览

![图片11.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片11.png)

状态页

![图片12.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片12.png)

告警页

![图片13.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片13.png)

●Grafana 
概览页

![图片14.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片14.png)

创建的监控页面

![图片15.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片15.png)

上述监控套件安装完之后，在集群管理页面点击【进入】，即可进入集群服务组件管理页面

![图片16.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/1/图片16.png)

##### 添加服务
###### 1、安装Zookeepr
点击【服务管理】--> 【添加服务】选择ZooKeeper

![图片1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/图片1.png)

分配ZooKeeper master服务角色部署节点，master需要时奇数个 3 或是 5个。

![图片2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/图片2.png)

Zookeeper不区分worker与client服务角色，直接点击【下一步】
根据实际需求调整服务配置

![图片3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/图片3.png)

点击【下一步】 安装 Zookeeper

![图片4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/图片4.png)

安装成功后在【服务管理】中查看Zookeeper总览

![图片5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/图片5.png)

###### 2、安装HDFS
点击【服务管理】【添加服务】选择HDFS

![hdfs-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-1.png)

部署HDFS，其中JournalNode需部署三台，NameNode部署两台，ZKFC和NameNode部署在相同机器上

![hdfs-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-2.png)

点击【下一步】，选择DataNode部署节点和HDFSClient部署节点

![hdfs-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-3.png)

点击【下一步】，按照实际需求配置服务，比如修改集群名称、DataNode数据存储目录。

![hdfs-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-4.png)

点击【下一步】，开始安装Hdfs。

![hdfs-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-5.png)

安装成功后，即可查看HDFS服务总览页面。

![hdfs-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-6.png)

可以根据实际需要再配置页修改hdfs集群配置

![hdfs-7.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hdfs-7.png)

###### 3.安装YARN(分布式资源调度与管理平台)

点击【服务管理】【添加服务】选择 YARN

![yarn-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-1.png)

点击【下一步】分配服务Master角色，要实现高可用，ResourceManager需要部署两台

![yarn-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-2.png)

点击【下一步】分配 NodeManager节点

![yarn-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-3.png)

点击【下一步】根据实际情况修改服务配置

![yarn-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-4.png)

点击【下一步】，开始安装YARN

![yarn-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-5.png)

![yarn-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-6.png)

安装成功后在【服务管理】中可查看服务总览

![yarn-7.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-7.png)

可以根据实际需要再配置页修改YARN集群配置

![yarn-8.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/yarn-8.png)

###### 4、安装Spark(分布式计算系统)

点击【服务管理】【添加服务】选择 Spark3

![spark-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-1.png)

点击【下一步】Spark没有master角色 直接点击【下一步】

![spark-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-2.png)

![spark-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-3.png)

在【服务配置】页面，根据实际需要修改服务配置

![spark-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-4.png)

点击【下一步】开始安装Spark3

![spark-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-5.png)

安装完成后，在【服务管理】部分查看Spark3的实例情况

![spark-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/spark-6.png)

5、安装Flink(实时计算引擎)

点击【服务管理】【添加服务】选择 Flink

![flink-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-1.png)

Flink 也没有Master角色之分，直接跳过进入【下一步】选择安装FlinkClient

![flink-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-2.png)

在服务配置页面根据实际需求修改配置

![flink-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-3.png)

点击【下一步】安装Flink

![flink-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-4.png)

安装成功后在【服务管理】模块可查看 Flink服务总览

![flink-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-5.png)

在配置页面可以根据需求修改Flink配置

![flink-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/flink-6.png)

###### 6、安装Hive(离线数据仓库)

在MySQL数据库中创建Hive相关库
```
CREATE DATABASE IF NOT EXISTS hive DEFAULT CHARACTER SET utf8;
grant all privileges on *.* to hive@"%" identified by 'hive' with grant option;
GRANT ALL PRIVILEGES ON *.* TO 'hive'@'%';
FLUSH PRIVILEGES;
```
点击【服务管理】【添加服务】选择 Hive

![hive-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-1.png)

分配服务Master角色

![hive-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-2.png)

在【服务配置】页面，注意数据库连接参数和数据库用户名密码，安装HiveServer2时会执行sql创建Hive的表，在个别情况下会因mysql配置导致sql执行失败，可根据实际失败原因修改mysql配置。

![hive-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-3.png)

下一步开始安装

![hive-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-4.png)

完成之后在【服务管理】Hive可用查看总览

![hive-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-5.png)

配置页面可以再根据实际需要修改hive服务配置

![hive-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/hive-6.png)

###### 7. 安装Kafka

点击【服务管理】【添加服务】选择 Kafka

![kafka-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-1.png)

根据需要选择KafkaBroker位置

![kafka-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-2.png)

Kafka没有wokrer和client角色，直接跳过到下一步

![kafka-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-3.png)

在【服务配置】页面根据实际需要调整配置，因kafka依赖Zookeeper，所以安装kafka之前请先安装Zookeeper集群

![kafka-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-4.png)

点击【下一步】开始安装kafka集群

![kafka-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-5.png)

在【服务管理】点击kafka可查看服务总览

![kafka-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-6.png)

在【配置】页面可以根据实际需要调整kafka集群配置

![kafka-7.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/kafka-7.png)

###### 8.安装DolphinScheduler

在mysql服务上初始化Dolphinscheduler所需数据库

```
CREATE DATABASE dolphinscheduler DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL PRIVILEGES ON dolphinscheduler.* TO 'dolphinscheduler'@'%' IDENTIFIED BY 'dolphinscheduler';
GRANT ALL PRIVILEGES ON dolphinscheduler.* TO 'dolphinscheduler'@'localhost' IDENTIFIED BY 'dolphinscheduler';
flush privileges;
```

执行/opt/datasophon/DDP/packages目录下dolphinscheduler_mysql.sql创建dolphinscheduler数据库表。

【服务管理】【添加服务】选择DolphinScheduler

![ds-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-1.png)

分配master角色

![ds-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-2.png)

添加workerserver

![ds-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-3.png)

在【服务配置】页面，修改配置，注意之前创建的mysql所在的服务器与用户名密码

![ds-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-4.png)

开始安装

![ds-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-5.png)

完成之后在【服务管理】中查看总览

![ds-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-6.png)

在【配置】页面根据实际需要修改配置

![ds-7.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/ds-7.png)

###### 9.安装 StreamPark[流处理极速开发框架,流批一体&湖仓一体的云原生平台,一站式流处理计算平台]

初始化StreamPark数据库

```
CREATE DATABASE streampark DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL PRIVILEGES ON streampark.* TO 'streampark'@'%' IDENTIFIED BY 'streampark';
GRANT ALL PRIVILEGES ON streampark.* TO 'streampark'@'localhost' IDENTIFIED BY 'streampark';
flush privileges;
```

【服务管理】【添加服务】选择 StreamPark

![StreamPark-1.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-1.png)

分配Master角色

![StreamPark-2.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-2.png)

跳过worker与client角色 直接点击【下一步】

![StreamPark-3.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-3.png)

在【服务配置】页面，根据实际需求修改配置，重点注意创建mysql库时的服务器地址与用户名密码

![StreamPark-4.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-4.png)

点击【下一步】开始安装

![StreamPark-5.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-5.png)

安装完成之后在【服务管理】点击StreamPark查看总览

![StreamPark-6.png](/i18n/zh-Hans/docusaurus-plugin-content-docs/current/部署文档/imgs/2/StreamPark-6.png)
